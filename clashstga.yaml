# ---------------------------------------------------
# 1. 基础设置 (Based on your "基础" section)
# ---------------------------------------------------
port: 7890
socks-port: 7891
allow-lan: true
mode: rule
log-level: info
external-controller: :9090

# DNS 设置
dns:
  enable: true
  ipv6: false
  listen: :53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "+.local"
    - "ac.ursusx.com" # 你特别指定的
  nameserver:
    - 114.114.114.114
    - 223.5.5.5

# ---------------------------------------------------
# 2. 策略组 (Proxy Groups)
# ---------------------------------------------------
proxy-groups:
  # --- 上层功能组 (根据你的 custom_proxy_group) ---
  
  - name: AI
    type: select
    proxies: [DIRECT, 所有-选择, 香港-自动, 台湾-自动, REJECT]

  - name: 国外
    type: select
    proxies: [DIRECT, 所有-选择, 香港-自动, 台湾-自动, REJECT]

  - name: Emby
    type: select
    proxies: [Emby-专用, DIRECT]

  - name: 国内
    type: select
    proxies: [DIRECT, 所有-选择, 香港-自动, 台湾-自动, REJECT]

  - name: 漏网之鱼
    type: select
    proxies: [DIRECT, 所有-选择, 香港-自动, 台湾-自动, REJECT]

  # --- 底层地区/节点筛选组 ---

  - name: 香港-自动
    type: url-test
    include-all: true
    filter: "(?i)(香港|Hong Kong|HongKong)"
    tolerance: 50
    interval: 300

  - name: 台湾-自动
    type: url-test
    include-all: true
    filter: "(?i)(Taiwan ISP)" # 注意：你的正则写的是 Taiwan ISP，如果节点名不含此关键词将筛选不到
    tolerance: 50
    interval: 300

  - name: Emby-专用
    type: select
    include-all: true
    filter: "(?i)(Emby)"

  - name: 所有-选择
    type: select
    include-all: true
    filter: ".*"

# ---------------------------------------------------
# 3. 规则集提供者 (Rule Providers)
# ---------------------------------------------------
rule-providers:
  # 国内组源
  p_domestic_mydomain:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Blaine-Li/SomeDomain/master/Mydomain.list"
    path: ./rules/Mydomain.list
    interval: 86400

  p_domestic_lan:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/LocalAreaNetwork.list"
    path: ./rules/LocalAreaNetwork.list
    interval: 86400

  p_domestic_unban:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/UnBan.list"
    path: ./rules/UnBan.list
    interval: 86400

  p_domestic_chinadomain:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaDomain.list"
    path: ./rules/ChinaDomain.list
    interval: 86400

  p_domestic_chinamedia:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaMedia.list"
    path: ./rules/ChinaMedia.list
    interval: 86400

  p_domestic_companyip:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaCompanyIp.list"
    path: ./rules/ChinaCompanyIp.list
    interval: 86400
  
  p_domestic_chinaip:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaIp.list"
    path: ./rules/ChinaIp.list
    interval: 86400

  # Emby源
  p_emby:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Blaine-Li/SomeDomain/master/Emby.list"
    path: ./rules/Emby.list
    interval: 86400

  # AI源 (合并了你列表中指向 AI 组的所有 list)
  p_ai_1:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/liandu2024/clash/refs/heads/main/list/AI.list"
    path: ./rules/AI.list
    interval: 86400
  p_ai_2:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Blaine-Li/SomeDomain/refs/heads/master/AI2.list"
    path: ./rules/AI2.list
    interval: 86400
  p_ai_twitter:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter.list"
    path: ./rules/Twitter.list
    interval: 86400
  p_ai_whatsapp:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Whatsapp/Whatsapp.list"
    path: ./rules/Whatsapp.list
    interval: 86400
  p_ai_facebook:
    type: http
    behavior: classical
    url: "https://gist.githubusercontent.com/Blaine-Li/d954c04c3d6c763774915fbbfe1e94c2/raw/fb0ec120474451b276ce8f7a8d11042f61df59fa/Facebook.list"
    path: ./rules/Facebook.list
    interval: 86400
  p_ai_paypal:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/PayPal/PayPal.list"
    path: ./rules/PayPal.list
    interval: 86400

  # 国外源
  p_foreign_youtube:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.list"
    path: ./rules/YouTube.list
    interval: 86400
  p_foreign_youtube_2:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/liandu2024/clash/refs/heads/main/list/YouTube.list"
    path: ./rules/YouTube2.list
    interval: 86400
  p_foreign_hbo:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/HBO/HBO.list"
    path: ./rules/HBO.list
    interval: 86400
  p_foreign_disney:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Disney/Disney.list"
    path: ./rules/Disney.list
    interval: 86400
  p_foreign_netflix:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Netflix/Netflix.list"
    path: ./rules/Netflix.list
    interval: 86400
  p_foreign_spotify:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Spotify/Spotify.list"
    path: ./rules/Spotify.list
    interval: 86400
  p_foreign_check:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/liandu2024/clash/refs/heads/main/list/Check.list"
    path: ./rules/Check.list
    interval: 86400
  p_foreign_proxy:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/liandu2024/clash/refs/heads/main/list/Proxy.list"
    path: ./rules/Proxy.list
    interval: 86400
  p_foreign_global:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Global/Global.list"
    path: ./rules/Global.list
    interval: 86400

# ---------------------------------------------------
#4. 规则匹配 (Rules)
# ---------------------------------------------------
rules:
  # 国内
  - RULE-SET,p_domestic_mydomain,国内
  - RULE-SET,p_domestic_lan,国内
  - RULE-SET,p_domestic_unban,国内
  - RULE-SET,p_domestic_chinadomain,国内
  - RULE-SET,p_domestic_chinamedia,国内
  - RULE-SET,p_domestic_companyip,国内
  - RULE-SET,p_domestic_chinaip,国内

  # Emby
  - RULE-SET,p_emby,Emby

  # AI (包含你归类到此组的 Twitter/FB/Whatsapp 等)
  - RULE-SET,p_ai_1,AI
  - RULE-SET,p_ai_2,AI
  - RULE-SET,p_ai_twitter,AI
  - RULE-SET,p_ai_whatsapp,AI
  - RULE-SET,p_ai_facebook,AI
  - RULE-SET,p_ai_paypal,AI

  # 国外
  - RULE-SET,p_foreign_youtube,国外
  - RULE-SET,p_foreign_youtube_2,国外
  - RULE-SET,p_foreign_hbo,国外
  - RULE-SET,p_foreign_disney,国外
  - RULE-SET,p_foreign_netflix,国外
  - RULE-SET,p_foreign_spotify,国外
  - RULE-SET,p_foreign_check,国外
  - RULE-SET,p_foreign_proxy,国外
  - RULE-SET,p_foreign_global,国外

  # 漏网之鱼
  - MATCH,漏网之鱼
